<?xml version="1.0"?>
<launch>

    <arg name="id_robot" default="rbkairos"/>

    <arg name="x_init_pose" default="0"/>
    <arg name="y_init_pose" default="0"/>
    <arg name="z_init_pose" default="0"/>
    <arg name="yaw_init_pose" default="0"/>

    <arg name="arm_model" default="panda"/>
    <arg name="arm_id" default="$(arg arm_model)"/>
    <arg name="launch_amcl" default="true"/>
    <arg name="launch_gmapping" default="false"/>
    <arg name="launch_move_base" default="true"/>
    
    <arg name="ros_planar_move_plugin" default="true"/><!-- plugin to simulate omni drive -->

    <arg name="launch_move_group" default="false"/>    <!-- moveit -->
    <arg name="odom_model_type" default="omni"/>
    <arg name="movebase_local_planner" default="teb"/>

    <arg name="transmission" default="position" />

    <!-- Change the global_frame and map topic to /map -->
    <arg name="global_frame" default="map"/>
    <arg name="map_topic" default="/map"/>

    <!-- BEGIN ROBOT -->
    <group ns="$(arg id_robot)">

        <arg name="prefix" value="$(arg id_robot)_"/>

        <!-- amcl and map server base  TODO: MAYBE PREFIX needs to change-->
        <include if="$(arg launch_amcl)" file="$(find summit_xl_localization)/launch/amcl.launch">
            <arg name="prefix" value="$(arg prefix)"/>
            <arg name="x_init_pose" value="$(arg x_init_pose)"/>
            <arg name="y_init_pose" value="$(arg y_init_pose)"/>
            <arg name="z_init_pose" value="$(arg z_init_pose)"/>
            <arg name="odom_model_type" value="$(arg odom_model_type)"/>
            <arg name="map_topic" value="$(arg map_topic)"/>
            <arg name="global_frame" value="/$(arg global_frame)"/>
        </include>

        <!-- move base -->
        <include if="$(arg launch_move_base)" file="$(find summit_xl_navigation)/launch/move_base.launch">
            <arg name="prefix" value="$(arg prefix)"/>
            <arg name="local_planner" value="$(arg movebase_local_planner)"/>
            <arg if="$(arg ros_planar_move_plugin)" name="differential_robot" value="false"/>
            <arg unless="$(arg ros_planar_move_plugin)" name="differential_robot" value="true"/>
            <arg name="global_frame" value="$(arg global_frame)"/>
            
        </include>

        <!-- gmapping -->
        <include if="$(arg launch_gmapping)" file="$(find summit_xl_localization)/launch/slam_gmapping.launch">
            <arg name="prefix" value="$(arg prefix)"/>
            <arg name="global_frame" value="/$(arg global_frame)"/> <!-- Not tested -->
        </include>

        <!-- MoveGroup Moveit! -->
        <include if="$(arg launch_move_group)" file="$(find rbkairos_panda_moveit_config)/launch/demo.launch">
            <arg name="load_robot_description" value="false"/>
            <arg name="moveit_controller_manager" value="simple" />
            <arg name="arm_id" value="$(arg arm_id)" />
            <arg name="transmission" value="$(arg transmission)" />
        </include>

    </group>



</launch>
